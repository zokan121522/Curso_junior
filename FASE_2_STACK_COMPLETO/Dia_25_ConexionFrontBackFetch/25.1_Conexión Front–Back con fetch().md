
# 🧩 Conexión Front–Back con fetch()

Verás cómo mostrar tareas desde tu API FastAPI en el frontend React usando fetch() y useEffect.

---

## 📚 Clase 25 — Mostrar tareas en React con fetch y useEffect

### 💡  Qué debes ENTENDER (no memorizar)
	•	Qué hace fetch() → Llama a una API desde JS.
	•	Qué hace useEffect() → Ejecuta código cuando el componente se monta.
	•	Qué es el estado (useState) → Guarda los datos que llegan.
	•	Cómo se muestran las tareas en una lista en el frontend.
	•	Cómo se enlaza el backend FastAPI con React sin complicaciones.

---

## 🧠 Esquema visual del flujo
```jsx
React App        ⇄        FastAPI (main.py)
  ↓ useEffect()                ↑
  fetch("/tareas") →   [API responde con JSON]
  ↓
  setTareas(data)
  ↓
  .map() para mostrar
```

---


## 🔀 ORDEN IDEAL DE TRABAJO
| Paso | Acción                                                       | ¿Por qué es importante?                                  |
|----|--------------------------------------------------------------|------------------------------------------------------------|
|  1.| Crear carpeta del proyecto general (`mi-proyecto/`)          | Para tener todo organizado en un solo sitio.               |
| 2. | Crear el entorno virtual Python (`python3 -m venv env`)      | Aíslas dependencias del backend FastAPI.                   |
| 3. | Activar el entorno (`source env/bin/activate`)               | Para instalar FastAPI y usar uvicorn, etc.                 |
| 4. | Crear carpeta `backend/` y tu `main.py`, `requirements.txt`  | Backend separado y limpio.                                 |
| 5. | Crear carpeta `frontend/` y usar tu `newreact.sh` ahí        | Mantienes el frontend aislado con su propio `node_modules/`|


## 🎯 Resultado ideal de estructura
```
mi-proyecto/
├── backend/              ← FastAPI aquí
│   ├── main.py
│   ├── env/              ← Entorno virtual
│   ├── requirements.txt
│   └── ...
├── frontend/             ← React generado con tu script
│   ├── src/
│   ├── App.jsx
│   ├── node_modules/
│   └── ...
└── README.md             ← (opcional pero útil)
```

---
## 🛠 Paso a paso

### 1. Arranca tu backend FastAPI
```bash
uvicorn main:app --reload
```
>Confirma que tienes un endpoint GET /tareas que devuelve un JSON como:
```json
[
  { "id": 1, "titulo": "Aprender React", "done": false },
  { "id": 2, "titulo": "Practicar Pytest", "done": true }
]
```

---

### 2. Estructura tu componente React
```jsx
// App.jsx
import { useState, useEffect } from "react";

function App() {
  const [tareas, setTareas] = useState([]);

  useEffect(() => {
    fetch("http://localhost:8000/tareas")
      .then((res) => res.json())
      .then((data) => setTareas(data))
      .catch((error) => console.error("Error:", error));
  }, []);

  return (
    <div className="p-8">
      <h1 className="text-2xl font-bold mb-4">📋 Lista de Tareas</h1>
      <ul className="space-y-2">
        {tareas.map((tarea) => (
          <li
            key={tarea.id}
            className={`p-4 rounded shadow ${tarea.done ? "bg-green-100" : "bg-yellow-100"}`}
          >
            ✅ {tarea.titulo}
          </li>
        ))}
      </ul>
    </div>
  );
}

export default App;
```
---

## ✅ PASO A PASO — Ver tu página en tiempo real (frontend)
# ✅ PASO A PASO — Backend + Frontend conectados (Clase 25)

| Paso | Acción                                                   | Comando / Notas                                                                                                                                         |
|------|-----------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------|
| 1    | Crear estructura de carpetas                              | `mkdir entorno25 && cd entorno25 && mkdir backend && cd backend`                                                                                       |
| 2    | Crear entorno virtual Python                              | `python3 -m venv env`                                                                                                                                   |
| 3    | Activar entorno virtual                                   | `source env/bin/activate`                                                                                                                               |
| 4    | Crear `requirements.txt` con VSCode                       | `code requirements.txt` → luego insertar el snippet global de dependencias (`fastapi`, `sqlmodel`, `uvicorn`, etc.)                                   |
| 5    | Instalar dependencias del backend                         | `pip install -r requirements.txt`                                                                                                                       |
| 6    | Crear y abrir `main.py`                                   | `code main.py` → insertar el snippet global de **FastAPI + SQLModel CRUD (Tareas)**                                                                    |
| 7    | Insertar CORS para conectar frontend                      | Insertar el snippet `CORS Middleware` **después de `app = FastAPI()`**                                                                                 |
| 8    | Ejecutar el servidor de la API (FastAPI)                  | `uvicorn main:app --reload`                                                                                                                             |
| 9    | Copiar script de React boilerplate (`newreact.sh`)       | `cp newreact.sh entorno25/`                                                                                                                             |
| 10   | Volver a la raíz del proyecto                             | `cd ..` (desde `/backend` a `/entorno25`)                                                                                                               |
| 11   | Generar proyecto React                                     | `./newreact.sh frontend`                                                                                                                                |
| 12   | Iniciar el frontend React                                 | `cd frontend` → `npm run dev`                                                                                                                           |
| 13   | Abrir la web en navegador                                 | Visita 👉 `http://localhost:5173` (o el puerto que indique la consola)                                                                                   |
| 14   | Ir a `frontend/src/App.jsx`                               | Reemplaza el contenido con el snippet `react.fetch.lista.generica`                                                                                      |
| 15   | Cambiar la URL en `fetch()`                               | Usa `http://localhost:8000/tareas` (la URL del backend FastAPI)                                                                                        |
| 16   | Probar conexión con un POST manual                        | Ejecuta desde terminal:<br>`curl -X POST http://localhost:8000/tareas \`<br>`-H "Content-Type: application/json" \`<br>`-d '{"titulo": "Aprender FastAPI", "done": false}'` |
| 17   | Recargar el navegador                                     | Visita el frontend y pulsa “🔁 Refrescar” → Verás la tarea **“Aprender FastAPI”** mostrada con fondo amarillo (pendiente)                             |
---


## 💡 ¿Por qué funciona?
	•	useEffect() se ejecuta una sola vez al montar el componente.
	•	fetch() va al backend FastAPI y pide /tareas.
	•	Al recibir el JSON, usamos setTareas(data) para actualizar el estado.
	•	El .map() renderiza cada tarea como una <li> con estilos.

---

## 📋 Checklist de comprensión

| ¿Lo entiendes? | Pregunta                                         | Respuesta                                       |
|----------------|--------------------------------------------------|-------------------------------------------------|
| Sí / No        | ¿Qué hace fetch()?                               | Llama a la API y espera una respuesta           |
| Sí / No        | ¿Dónde se guarda el JSON recibido?               | En el useState                                  |
| Sí / No        | ¿Qué dispara useEffect()?                        | El montaje del componente                       |
| Sí / No        | ¿Qué hace .map()?                                | Itera sobre las tareas para mostrarlas          |
| Sí / No        | ¿Dónde se ven los errores?                       | En la consola del navegador                     |


---

## 📚 Tabla de conceptos — Clase 25

| 🧩 Concepto       | 📖 Explicación técnica                                  | 💬 Explicación coloquial                                      |
|-------------------|--------------------------------------------------------|---------------------------------------------------------------|
| fetch()           | Función para hacer peticiones HTTP desde JS             | 📡 “El mensajero que va a la API a pedir datos.”              |
| useEffect()       | Hook que se ejecuta tras renderizar el componente       | ⏰ “Haz esto justo cuando aparezca en pantalla.”               |
| useState()        | Hook que guarda valores reactivos                       | 🧠 “La memoria de tu componente.”                             |
| .map()            | Recorre arrays y devuelve elementos JSX                 | 🪄 “Convierte una lista en componentes visuales.”              |
| 📦 **res.json()**     | 🔄 Convierte respuesta en objeto JS            | 📦 “Abre el paquete que llega.”                  |
| 📝 **setTareas()**    | 🔁 Cambia el estado con nuevas tareas          | 🔄 “Actualiza lo que se ve.”                     |
| 🧷 **key={...}**      | 🆔 Identificador único en .map()               | 🏷 “Etiqueta para no duplicar elementos.”        |
| 🏠 **localhost:8000** | 🌐 URL local del backend FastAPI               | 🖥 “Tu servidor corriendo en casa.”              |
| 📃 **GET /tareas**    | 📥 Ruta que devuelve la lista de tareas        | 📋 “La lista entera de cosas por hacer.”         |


---

## 🎯 Con esto ya puedes:
	•	Leer datos reales del backend desde React
	•	Mostrar una lista dinámica de tareas en tu frontend
	•	Entender los 3 hooks clave en React: useState, useEffect, map

---

Perfecto. Vamos con los Ejercicios prácticos guiados de la Clase 25 – React + FastAPI (fetch + useEffect). Al final te generaré los dos archivos .code-snippets como los tienes organizado por VS Code.

---

## 🧪 Ejercicios prácticos guiados — Clase 25

---

### 🧩 Ejercicio 1 – Mostrar “Pendiente” o “Hecho” según el campo done

##### 🎯 Objetivo: Mostrar el estado de cada tarea con texto legible para humanos.

##### 📥 Entrada esperada desde la API:
```json
{ "titulo": "Estudiar React", "done": true }
```
##### 🧠 Lógica:
	•	Si done es true → mostrar “✅ Hecho”
	•	Si done es false → mostrar “⏳ Pendiente”

##### ✅ Paso a paso:
```jsx
// 1. Localiza este trozo en el .map():
    {tarea.titulo}
```
```jsx
// 2. Modifícalo así:
    {tarea.titulo} – {tarea.done ? "✅ Hecho" : "⏳ Pendiente"}
```

---

### 🧩 Ejercicio 2 – Añadir un botón “Refrescar” que vuelva a hacer fetch

##### 🎯 Objetivo: Poder actualizar la lista de tareas sin recargar toda la página.

##### 🧠 Lógica:
	•	Crear una función loadTareas()
	•	Reutilizar fetch() dentro de esa función
	•	Añadir botón con onClick={loadTareas}

##### ✅ Paso a paso:
```jsx
// 1. Mueve la lógica de fetch() a una nueva función:
function loadTareas() {
  fetch("http://localhost:8000/tareas")
    .then((res) => res.json())
    .then((data) => setTareas(data));
}
```
```jsx
// 2. En useEffect, llama a loadTareas():
useEffect(() => {
  loadTareas();
}, []);
```
```jsx
//3. Añade este botón encima de la lista:
<button
  onClick={loadTareas}
  className="mb-4 px-4 py-2 bg-blue-500 text-white rounded"
>
  🔁 Refrescar
</button>
```

---

### 🧩 Ejercicio 3 – Mostrar mensaje “Cargando…” mientras se obtienen los datos

##### 🎯 Objetivo: Indicar visualmente que los datos están siendo cargados.

##### 🧠 Lógica:
	•	Añadir un nuevo estado cargando
	•	Al empezar fetch → setCargando(true)
	•	Al terminar → setCargando(false)
	•	Mostrar <p>Cargando tareas...</p> si cargando === true

##### ✅ Paso a paso:
```jsx
// 1. Crea el estado:
const [cargando, setCargando] = useState(false);
```
```jsx
// 2. Modifica loadTareas():
function loadTareas() {
  setCargando(true);
  fetch("http://localhost:8000/tareas")
    .then((res) => res.json())
    .then((data) => setTareas(data))
    .finally(() => setCargando(false));
}
```
```jsx
// 3. En el return, antes de mapear:
{cargando ? (
  <p className="text-gray-500">⏳ Cargando tareas...</p>
) : (
  <ul className="space-y-2">
    {tareas.map((tarea) => (
      <li
        key={tarea.id}
        className={`p-4 rounded shadow ${tarea.done ? "bg-green-100" : "bg-yellow-100"}`}
      >
        ✅ {tarea.titulo} – {tarea.done ? "Hecho" : "Pendiente"}
      </li>
    ))}
  </ul>
)}
```

---


## ✅ CONTENIDO CUBIERTO DEL DÍA 25

| Tema                                   | Ejercicio                                                   |
|----------------------------------------|-------------------------------------------------------------|
| Conexión Front–Back                    | Ejercicio 1–3 (fetch(), useEffect)                          |
| Mostrar datos con useEffect()          | Ejercicio 1 + estructura base                               |
| Llamar a una API (fetch)               | Ejercicio 2 (loadTareas)                                    |
| Guardar datos con useState()           | Todos                                                       |
| Mostrar lista con .map()               | En todos los renders                                        |
| Controlar estados (loading)            | Ejercicio 3 (cargando)                                      |
| Actualizar datos con botón              | Ejercicio 2                                                 |
| Mostrar estados personalizados (done) | Ejercicio 1                                                 |
| Estilo visual con Tailwind              | En todos (clases como bg-green-100, rounded, p-8)           |


---

## 🧠 ¿Y qué no hace falta hacer?
	•	No necesitas tocar main.py si ya tienes /tareas funcionando.
	•	No se pide crear tareas desde el frontend aún (eso será otro día).
	•	Tampoco se piden formularios ni DELETE por ahora.

---

## 📌 ¿Qué se recomienda para consolidar?
	•	Que pruebes cambiar el endpoint (por ejemplo /productos) y ajustarlo.
	•	Que hagas un mini reto por tu cuenta: mostrar cuántas tareas hay en total (ej. Total: 5 tareas).
	•	Que añadas control de errores si el servidor está caído (con try...catch o .catch() más elaborado).




