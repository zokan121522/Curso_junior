# Clase 21 â€“ Rutas dinÃ¡micas, parÃ¡metros y validaciÃ³n en FastAPI
---
#### Hoy aprenderÃ¡s a capturar datos directamente desde la URL, validar que existan y devolver respuestas personalizadas.



## ğŸ“š OBJETIVO DEL DÃA
```bash
Crear una pequeÃ±a API con una ruta dinÃ¡mica:
	â€¢	GET /usuario/{id}
	â€¢	BuscarÃ¡ el ID en una lista simulada y devolverÃ¡ su informaciÃ³n
	â€¢	Si no existe, devuelve un error 404 con mensaje claro
```
---

## ğŸ’¡ Pista extra para reconstruir tu main.py
```py
1.	Comienza siempre con las importaciones (FastAPI, HTTPException, JSONResponse).
2.	Crea la instancia de app con app = FastAPI().
3.	Define tu lista usuarios con al menos 3 diccionarios.
4.	Usa @app.get("/usuario/{id}") para crear una ruta dinÃ¡mica.
5.	Dentro de la funciÃ³n, recorre la lista y busca el id.
6.	Devuelve una respuesta JSON si existe, o lanza un error si no.
```
## ğŸ§ª EJERCICIO_ 1 
```py
# BÃºsqueda en lista con GET /usuario/{id} y respuesta condicional
# ğŸ“„ main.py
# ğŸ“¦ 1. Importamos FastAPI + herramientas extra
from fastapi import FastAPI, HTTPException
from fastapi.responses import JSONResponse

# ğŸš€ 2. Creamos la instancia de FastAPI
app = FastAPI()

# ğŸ§‘â€ğŸ¤â€ğŸ§‘ 3. Simulamos una lista de usuarios
usuarios = [
    {"id": 1, "nombre": "Ana", "edad": 28},
    {"id": 2, "nombre": "Luis", "edad": 35},
    {"id": 3, "nombre": "Clara", "edad": 22},
]

# ğŸ“ 4. Ruta dinÃ¡mica con parÃ¡metro: /usuario/2
@app.get("/usuario/{id}")
def obtener_usuario(id: int):  # ğŸ‘ˆ FastAPI convierte id a nÃºmero automÃ¡ticamente
    for usuario in usuarios:
        if usuario["id"] == id:
            # ğŸ Si se encuentra, devolvemos un JSON con los datos
            return JSONResponse(content=usuario, status_code=200)
    
    # âŒ Si no se encuentra, lanzamos un error 404
    raise HTTPException(status_code=404, detail=f"Usuario con id {id} no encontrado")
```

## ğŸ§­ FLUJO LÃ“GICO

|Paso	|Â¿QuÃ© ocurre?|
|-------|-------------------------------------------------------|
| 1.	| Se entra a la ruta /usuario/2 desde el navegador o Postman|
| 2.	| FastAPI detecta el 2 como parÃ¡metro y lo guarda en id |
| 3.	| Se recorre la lista usuarios buscando coincidencia |
| 4.	| Si encuentra un usuario con id == 2, lo devuelve como JSON |
| 5.	| Si no lo encuentra, lanza un error 404 automÃ¡ticamente |

---
## ğŸ§ª EJERCICIO_ 2 
```py
# Ruta dinÃ¡mica GET /usuario/{id} con validaciÃ³n y respuesta personalizada
# ğŸ“„ main.py
# âœ… Importamos FastAPI y las herramientas para respuestas y errores personalizados
from fastapi import FastAPI, HTTPException        # ğŸ§  FastAPI + gestiÃ³n de errores
from fastapi.responses import JSONResponse        # ğŸ§¾ Para personalizar la respuesta en formato JSON

# ğŸ§  Creamos instancia de la app FastAPI
app = FastAPI()

# ğŸ“¦ Simulamos una "base de datos" con usuarios ficticios
usuarios = {
    1: {"nombre": "Ana GarcÃ­a", "edad": 28},
    2: {"nombre": "Luis PÃ©rez", "edad": 35},
    3: {"nombre": "Carlos Ruiz", "edad": 40}
}

# ğŸ“¡ Ruta dinÃ¡mica: GET /usuario/1 â†’ captura el nÃºmero como parÃ¡metro
@app.get("/usuario/{id}")  # ğŸ” Lo que va entre {id} se extrae desde la URL
def obtener_usuario(id: int):  # ğŸ”¢ Tipamos el parÃ¡metro como entero â†’ FastAPI lo convierte automÃ¡ticamente

    # ğŸ§ª Comprobamos si el usuario existe en el diccionario
    if id not in usuarios:
        # ğŸš¨ Si no existe, lanzamos error con cÃ³digo 404 y mensaje
        raise HTTPException(
            status_code=404,                     # ğŸ“› CÃ³digo de error HTTP: 404 = No encontrado
            detail=f"Usuario con id {id} no encontrado"  # ğŸ“ Mensaje de error visible
        )

    # âœ… Si existe, devolvemos una respuesta JSON personalizada
    return JSONResponse(
        content={                                 # ğŸ” Diccionario que se convierte en JSON
            "usuario": usuarios[id],
            "mensaje": f"Hola, {usuarios[id]['nombre']} ğŸ‘‹"
        },
        status_code=200                           # âœ… CÃ³digo 200 = OK
    )
```
## ğŸ§­ FLUJO LÃ“GICO
| Paso | AcciÃ³n                                                                 | ExplicaciÃ³n                                                                 |
|------|------------------------------------------------------------------------|-----------------------------------------------------------------------------|
| 1.  | Importar FastAPI, HTTPException y JSONResponse                        | Se preparan las herramientas necesarias para gestionar rutas y respuestas  |
| 2.  | Crear instancia `app = FastAPI()`                                      | Se inicia el servidor web de FastAPI                                       |
| 3.  | Definir un diccionario `usuarios` simulando una base de datos         | Clave = ID del usuario, Valor = datos del usuario                          |
| 4.  | Crear ruta dinÃ¡mica `@app.get("/usuario/{id}")`                       | Ruta que captura el parÃ¡metro dinÃ¡mico `id` desde la URL                   |
| 5.  | Definir la funciÃ³n `obtener_usuario(id: int)`                         | Se convierte automÃ¡ticamente el `id` de string a nÃºmero (int)             |
| 6.  | Comprobar si `id` existe en `usuarios`                                | ValidaciÃ³n bÃ¡sica para evitar errores si el ID no existe                   |
| 7.  | Si el `id` no existe, lanzar `HTTPException` con status 404           | Devuelve un error controlado: â€œUsuario no encontradoâ€                      |
| 8.  | Si el `id` existe, usar `JSONResponse` para devolver los datos        | Se responde con un JSON que incluye el usuario y un mensaje personalizado |
| 9.  | Se devuelve status 200 (OK)                                           | Todo ha funcionado correctamente                                           |

---

## ğŸ§  APRENDIZAJE CLAVE
```bash
â€¢	Puedes recibir datos directamente desde la URL (/usuario/{id})
â€¢	FastAPI los convierte al tipo que hayas definido (int, str, etc.)
â€¢	Si algo va mal, puedes lanzar errores limpios con HTTPException
â€¢	Puedes devolver objetos JSON personalizados con JSONResponse
```
---
## ğŸ“  TABLA CONCEPTOS CLAVE 
| Elemento                                | Â¿QuÃ© hace?                                                                                      |
|-----------------------------------------|--------------------------------------------------------------------------------------------------|
| `@app.get("/usuario/{id}")`             | Crea una ruta dinÃ¡mica. Lo que estÃ© entre llaves `{id}` se captura desde la URL (ej: `/usuario/2`). |
| `def obtener_usuario(id: int)`          | Define la funciÃ³n que se ejecuta al acceder a la ruta. El `id` se convierte a nÃºmero automÃ¡ticamente. |
| `Response`                              | Representa la respuesta HTTP personalizada (contenido, tipo, estado, etc.).                      |
| `JSON`                                  | Formato de intercambio de datos entre backend y frontend. Ejemplo: `{ "nombre": "Ana" }`.        |
| `dict`                                  | Tipo de dato en Python (diccionario) que FastAPI convierte en JSON automÃ¡ticamente.              |
| `status_code`                           | CÃ³digo que indica el estado de la respuesta (ej: 200 = OK, 404 = No encontrado, etc.).           |
| `raise HTTPException(...)`              | Lanza un error controlado con cÃ³digo y mensaje personalizado si algo falla.                     |
| `from fastapi.responses import JSONResponse` | Permite enviar una respuesta personalizada como JSON.                                       |
| `from fastapi import HTTPException`     | Permite importar la clase para lanzar errores HTTP personalizados.                              |
| `@app.get(...)`                         | Decorador que define una ruta de tipo GET (lectura de informaciÃ³n).                             |
| `f"texto {variable}"`                   | f-string: inserta variables en texto fÃ¡cilmente. Ej: `f"Hola {nombre}"`.                         |
| `return {...}`                          | En FastAPI, si devuelves un diccionario, se convierte en JSON automÃ¡ticamente.                  |
| `type(parametro) == int`                | Verifica si una variable es del tipo `int` (aunque FastAPI ya lo controla si lo has tipado).    |
---

## ğŸ§¾ Tabla de CÃ³digos de Estado HTTP â€“ Respuestas comunes en APIs FastAPI
| CÃ³digo | Significado        | CuÃ¡ndo se usa                                                |
|--------|--------------------|--------------------------------------------------------------|
| 200    | âœ… OK              | Todo ha ido bien (GET, POST exitoso, etc.)                  |
| 201    | âœ… Created         | Recurso creado correctamente (POST que crea algo)           |
| 400    | âŒ Bad Request     | El cliente enviÃ³ algo mal (faltan datos, mal formato, etc.) |
| 401    | ğŸ”’ Unauthorized    | No estÃ¡s autenticado                                         |
| 403    | â›” Forbidden       | No tienes permisos para acceder                             |
| 404    | ğŸ” Not Found       | No se encontrÃ³ lo que pediste (como en este ejemplo de ID)  |
| 500    | ğŸ’¥ Server Error    | Algo se rompiÃ³ en el servidor                               |
---

## ğŸ§ª PRUEBA RÃPIDA
```bash
Haz esto en el navegador o Postman:
	â€¢	http://localhost:8000/usuario/1 â†’ âœ… Devuelve Ana
	â€¢	http://localhost:8000/usuario/99 â†’ âŒ Error 404: Usuario no encontrado
```
---
## ğŸ§¾ OPCIONAL â€“ Auto documentaciÃ³n
```bash
	â€¢	ğŸŒ Accede a: http://localhost:8000/docs
	â€¢	Puedes probar todo desde ahÃ­ sin Postman
```
