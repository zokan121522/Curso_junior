

# 📚 CLASE 20 – Introducción al Backend con FastAPI

## 🎯 OBJETIVO DEL DÍA

Aprender los fundamentos de FastAPI, crear un pequeño backend con dos rutas:

|Método  |	Ruta    	  |  Descripción														|
|------------------|------------------------------------------------------------------------|---|
|GET     |	/saludo	   |     Devuelve un saludo simple|
|POST	 |   /perfil	 |       Recibe datos JSON de un perfil|


## 🧠 ¿Qué es FastAPI?
```bash
FastAPI es un framework web en Python para crear APIs de forma rápida y
moderna, usando lo mejor de Python 3.6+ como:
	•	🎯 Tipado de datos (como TypeScript en JS)
	•	⚡ Muy rápido (como Node.js, gracias a Starlette)
	•	📄 Genera documentación automática de tus endpoints
```

## 🧩 ANALOGÍA
```bash
Piensa en FastAPI como una centralita de recepción:
	•	Los clientes (navegador o frontend) llaman a diferentes extensiones: /saludo, /perfil, etc.
	•	FastAPI recoge los datos, los procesa con funciones y devuelve una respuesta.
```
## Rutas
```bash
📂 tu_proyecto/
├── env/                  # 🧪 Entorno virtual (ignóralo)
├── main.py               # ✅ Aquí va tu app FastAPI
├── requirements.txt      # 📦 (opcional) para instalar dependencias
└── README.md             # 📝 Documentación del proyecto (opcional)
```

## 🛠️ Preparación del entorno
```bash
	1.	Crea una carpeta nueva para tu proyecto:

mkdir fastapi_intro && cd fastapi_intro

	2.	Crea entorno virtual y actívalo:

python -m venv env
source env/bin/activate  # En Windows: env\Scripts\activate

	3.	Instala FastAPI y Uvicorn:

pip install fastapi uvicorn
```

--- 

# ✅ Cómo vincular tu entorno virtual en VSCode sin volverte loco

## 🧠 ¿Problema?
>Instalaste `fastapi` en tu entorno, pero en VSCode aparece subrayado en rojo (`from fastapi`) → **VSCode no está usando tu entorno real.**


## 🛠️ PASOS PARA VINCULAR TU ENTORNO CORRECTO

### 1. 📍 Asegúrate de que el entorno está activado

```bash
source env/bin/activate  # o .venv/bin/activate
```

### 2. 🚀 Instala FastAPI en ese entorno (si no lo hiciste)
```bash
pip install fastapi uvicorn
```

### 3. 🔍 Descubre la ruta del Python del entorno
```bash
which python
```

#### 🔁 Te dará algo como:
```bash
/Users/tu_usuario/mi_proyecto/env/bin/python
```

### 4. 🧭 En VSCode → selecciona ese entorno
```bash
1.	Cmd + Shift + P → Python: Select Interpreter
2.	Selecciona → Enter interpreter path
3.	Pega la ruta del paso anterior
4.	✅ Confirmar
```

### 5. 🔄 Recarga la ventana VSCode
```bash
Cmd + Shift + P → Reload Window
```

### 6. 🧪 Verifica
```bash
En terminal integrada de VSCode:
which python
✅ Debe apuntar al entorno correcto (env/bin/python)
```

### 🎯 Resultado final
```bash
•	Sin errores en from fastapi
•	Autocompletado funcionando
•	FastAPI listo para correr:
```
```bash
uvicorn main:app --reload
```
---

## 🔍 ¿Conflicto con el puerto 8000?
```bash
FastAPI suele usar el puerto 8000. Si ya está ocupado, puedes comprobarlo y cerrarlo así:
```
## Ver qué proceso está usando el puerto 8000
```bash
lsof -i :8000
```

#### Ejemplo de salida:
```bash
COMMAND   PID   USER
python3  12345  zokan
```
#### 👉 Paso siguiente: matar el proceso (PID = 12345 en este caso):
```bash
kill 12345        # 🔁 Cierre normal
kill -9 12345     # 💣 Forzar si no responde
```
#### También puedes ver todos los puertos de desarrollo activos con:
```bash
lsof -i :8*
```

## uvicorn es un servidor
```bash
 web ASGI (Asynchronous Server Gateway Interface) ligero y ultra rápido, diseñado especialmente para correr aplicaciones
 asíncronas en Python, como las creadas con FastAPI.
```


## 🧠 ¿Por qué es importante uvicorn?
```bash
FastAPI no se ejecuta solo. Necesita un “motor” que reciba las peticiones HTTP y las redirija a tu app. Ese motor es uvicorn.
```
```bash
🚀 Piensa en esto así:
	•	🧠 FastAPI: tu lógica y tus rutas (/saludo, /perfil, etc.)
	•	🔌 uvicorn: el mensajero entre internet y tu app
	•	🛠️ Navegador → uvicorn → FastAPI → Respuesta
```
## 🧪 Explicacion del codigo
```py
# 📄 Importamos BaseModel de Pydantic
# Esto nos ayuda a validar y estructurar datos que llegan en el POST
# 🔍 FastAPI y Pydantic trabajan juntos: uno gestiona las rutas, y el otro verifica que los datos que llegan tengan sentido.

# 🧠 Creamos una instancia de FastAPI → Esto es nuestra app web
# 📞 Aquí empieza la centralita: es como levantar un teléfono para que alguien pueda llamarte (ruta).

# Ruta GET: /saludo
# 📡 GET = leer información (como mirar un cartel).
'''
🔍 Explicación:
	•	@app.get("/saludo") → Cada vez que alguien visita esa dirección (/saludo), se ejecuta la función saludar.
	•	return {...} → Devuelve un diccionario convertido a JSON automáticamente, que se puede ver desde el navegador o desde localhost:8000/docs.
'''

# 🧾 Definimos cómo debe lucir el objeto JSON que se envía en /perfil
'''
🧪 Esta clase sirve como molde: si llega algo diferente, FastAPI lanza un error automáticamente. ¡Sin que tú tengas que validar nada a mano!
'''

# 👤 Debe llegar un campo "nombre" tipo texto
# 🔢 Debe llegar un campo "edad" tipo número

# 📬 Ruta POST que recibe un perfil en formato JSON
'''
🔍 Explicación:
	•	@app.post("/perfil") → Cuando alguien envía un JSON a esta ruta, se ejecuta esta función.
	•	perfil: Perfil → FastAPI verifica que lo que llega cumple el formato definido por la clase Perfil.
	•	return → Devolvemos un mensaje personalizado con los datos que nos han enviado.
'''
```


## 🧪 CÓDIGO BASE – main.py
```py

# 📄 Importamos BaseModel de Pydantic
# Esto nos ayuda a validar y estructurar datos que llegan en el POST
# 🔍 FastAPI y Pydantic trabajan juntos: uno gestiona las rutas, y el otro verifica que los datos que llegan tengan sentido.
from fastapi import FastAPI
from pydantic import BaseModel

# 🧠 Creamos una instancia de FastAPI → Esto es nuestra app web
# 📞 Aquí empieza la centralita: es como levantar un teléfono para que alguien pueda llamarte (ruta).
app = FastAPI()

# Ruta GET: /saludo
# 📡 GET = leer información (como mirar un cartel).
'''
🔍 Explicación:
	•	@app.get("/saludo") → Cada vez que alguien visita esa dirección (/saludo), se ejecuta la función saludar.
	•	return {...} → Devuelve un diccionario convertido a JSON automáticamente, que se puede ver desde el navegador o desde localhost:8000/docs.
'''
@app.get("/saludo")
def saludar():
    return {"mensaje": "¡Hola desde FastAPI!"}

# 🧾 Definimos cómo debe lucir el objeto JSON que se envía en /perfil
'''
🧪 Esta clase sirve como molde: si llega algo diferente, FastAPI lanza un error automáticamente. ¡Sin que tú tengas que validar nada a mano!
'''
class Perfil(BaseModel):
    nombre: str   # 👤 Debe llegar un campo "nombre" tipo texto
    edad: int     # 🔢 Debe llegar un campo "edad" tipo número

# 📬 Ruta POST que recibe un perfil en formato JSON
'''
🔍 Explicación:
	•	@app.post("/perfil") → Cuando alguien envía un JSON a esta ruta, se ejecuta esta función.
	•	perfil: Perfil → FastAPI verifica que lo que llega cumple el formato definido por la clase Perfil.
	•	return → Devolvemos un mensaje personalizado con los datos que nos han enviado.
'''
@app.post("/perfil")
# Siempre se escribe así: def FUNCION (variable: Tipo)
# variable `perfil` debe seguir la estructura definida en la clase `Perfil`
def recibir_perfil(perfil: Perfil):
    return {
        "mensaje": f"Perfil recibido de {perfil.nombre}, edad {perfil.edad}"
    }

```

## 🧪 Recapitulando visualmente

| Parte             | ¿Qué hace?                                                               |
|------------------|---------------------------------------------------------------------------|
| `from fastapi`   | Importa el motor principal del backend                                    |
| `from pydantic`  | Permite validar los datos que llegan                                      |
| `app = FastAPI()`| Crea tu servidor web                                                      |
| `@app.get(...)`  | Ruta para leer algo (GET)                                                 |
| `@app.post(...)` | Ruta para enviar algo (POST con JSON)                                     |
| `class Perfil...`| Define el formato que esperamos (nombre + edad)                           |
| `uvicorn`        | Es quien arranca el motor y escucha peticiones en `localhost:8000`        |
| `📡 POST`		   | enviar información (como rellenar y mandar un formulario).				   |



## 🔹 http://localhost:8000
```bash
👉 Es la raíz de tu servidor FastAPI.
Cuando accedes ahí, verás un mensaje simple si tienes una ruta en /, o un error si no la has definido.
```
#### Ejemplo:
```py
@app.get("/")
def raiz():
    return {"mensaje": "Bienvenido a mi API"}
```
> Si no tienes una ruta / definida, verás un error 404 al entrar.

## 🔹 http://localhost:8000/docs

#### Te permite:

🧪 Funciones de la documentación interactiva en FastAPI (`/docs`)

| 🔧 Función.                      | ¿Para qué sirve?                                                             |
|----------------------------------|------------------------------------------------------------------------------|
| 📖 Ver todas las rutas           | Muestra todas las rutas (`GET`, `POST`, etc.) con sus descripciones.         |
| 🧪 Probar peticiones directamente| Permite enviar datos a la API sin usar Postman ni escribir código.           |
| 🧠 Ver el esquema de entrada     | Muestra qué campos se requieren en un `POST` o cualquier entrada validada.   |
| 🔁 Recibir la respuesta real     | Devuelve la respuesta real que generaría la API, como si fueras un frontend. |


> 👉 Es la documentación automática generada por FastAPI (usando Swagger UI).


## 🎯 Analogía rápida:
```bash
URL	Rol en la app
localhost:8000	Tu casa (la entrada principal)
localhost:8000/docs	El mapa interactivo de tu casa
```


## ▶️ EJECUTAR EL SERVIDOR
```bash
# En la ruta donde se encuentra el servidor
uvicorn main:app --reload

	•	Abre navegador en: http://localhost:8000
	•	Documentación automática: http://localhost:8000/docs
```

>🧭 Recuerda:
> Tu servidor no tiene una ruta /, solo estas dos:


## 🌐 Rutas básicas en FastAPI

| **Método** | **Ruta**    | **¿Qué hace?**                                  |
|------------|-------------|--------------------------------------------------|
| `GET`      | `/saludo`   | Devuelve un saludo simple.                      |
| `POST`     | `/perfil`   | Recibe datos tipo JSON (nombre + edad).         |


#### Qué hacer ahora:
```bash
1. Entra en la ruta que sí existe:

Ve a:
http://localhost:8000/saludo

Y deberías ver:
```
```py
{
  "mensaje": "¡Hola desde FastAPI!"
}
```
```bash
2. Usa Swagger para probar el POST:
```
> Visita:
http://localhost:8000/docs

```bash
Y ahí verás tu API documentada automáticamente (¡FastAPI lo hace solo!). Desde esa interfaz puedes:
	•	Ver la ruta GET /saludo y probarla.
	•	Usar el botón “POST /perfil”, hacer clic en “Try it out”, escribir un JSON como este:
```
```py
{
  "nombre": "Jaime",
  "edad": 30
}

# Y recibirás una respuesta como:

{
  "mensaje": "Perfil recibido de Jaime, edad 30"
}
```

## 🔍 LO QUE APRENDES
```bash
✅ Crear servidor con FastAPI
✅ Definir rutas GET y POST
✅ Usar modelos con Pydantic
✅ Recibir y validar JSON automáticamente
✅ Ver documentación Swagger automática
```

## 🧪 RETO DEL DÍA (Resumen)
```bash
	1.	Crea el archivo main.py como arriba.
	2.	Añade una ruta GET que devuelva un saludo.
	3.	Añade una ruta POST que reciba un perfil JSON (nombre, edad).
	4.	Prueba desde /docs en el navegador.
```
